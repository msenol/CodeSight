# Interactive CLI Setup Guide

## Overview

The CodeSight MCP Server includes a comprehensive interactive setup wizard that guides you through the configuration process. This wizard is designed to make initial configuration painless while ensuring all necessary settings are properly configured.

## Getting Started

### Running the Setup Wizard

```bash
cd typescript-mcp
npm run build
node dist/cli/index.js setup
```

The setup wizard will guide you through the following configuration sections:

## Configuration Sections

### 1. Server Configuration

Configure the basic server settings:

- **Server Port**: Default `4000` - The port the MCP server will listen on
- **Server Host**: Default `0.0.0.0` - The network interface to bind to
- **Environment**: Default `development` - Choose between `development` or `production`

### 2. Database Configuration

Choose your database backend:

#### SQLite (Recommended for Development)
- **Database Path**: Default `./data/codesight.db`
- Automatic database and directory creation
- No additional dependencies required

#### PostgreSQL (Recommended for Production)
- **Host**: Default `localhost`
- **Port**: Default `5432`
- **Database Name**: Default `codesight`
- **Username**: Default `postgres`
- **Password**: Secure password input (hidden)

### 3. Performance Configuration

Optimize performance for your use case:

- **Indexing Parallel Workers**: Default `4` - Number of concurrent indexing threads
- **Indexing Batch Size**: Default `500` - Files processed per batch
- **Cache Size**: Default `512` MB - Memory allocated for caching

### 4. Rust FFI Configuration

Configure high-performance Rust components:

- **Enable Rust FFI**: Default `yes` - Enable native Rust performance optimizations
- **Rust Library Path**: Default `../rust-core/target/release` - Path to compiled Rust libraries
- **Graceful Fallback**: Default `yes` - Fall back to TypeScript if Rust FFI fails

### 5. Authentication Configuration

Configure security settings:

- **Enable Authentication**: Default `no` - Enable API authentication
- **JWT Secret**: Auto-generated if not provided - Secret for JWT token signing
- **API Key**: Auto-generated if not provided - API key for programmatic access

### 6. Logging Configuration

Configure logging settings:

- **Log Level**: Default `info` - Choose from `error`, `warn`, `info`, `debug`
- **Log Format**: Default `text` - Choose between `text` or `json` formatting

## Configuration Review

After completing all sections, the wizard will display a configuration summary:

```
üìã Configuration Summary

port: 4000
host: 0.0.0.0
nodeEnv: development
database:
  type: sqlite
  path: ./data/codesight.db
indexing:
  parallelWorkers: 4
  batchSize: 500
cache:
  sizeMB: 512
rustFFI:
  enabled: true
  path: ../rust-core/target/release
  gracefulFallback: true
auth:
  enabled: false
logging:
  level: info
  format: text
```

## Editing Configuration

You can edit any configuration property during the review phase:

1. Choose `edit` when prompted to save the configuration
2. Enter the property path (e.g., `database.port`, `auth.enabled`)
3. Provide the new value
4. Repeat until all changes are complete

## Saving Configuration

The configuration is saved to a `.env` file in the current directory:

```bash
# Save this configuration?
[1] yes
[2] no
[3] edit
Choice (1-3): 1

‚úÖ Configuration saved to .env
üéâ Setup completed successfully!
You can now start the server with: codesight server
```

## Generated Configuration File

The wizard generates a comprehensive `.env` file:

```bash
# CodeSight MCP Server Configuration
# Generated by interactive setup wizard

# Server Settings
PORT=4000
HOST=0.0.0.0
NODE_ENV=development

# Database Settings
DATABASE_URL=sqlite://./data/codesight.db

# Performance Settings
INDEXING_PARALLEL_WORKERS=4
INDEXING_BATCH_SIZE=500
CACHE_SIZE_MB=512

# Rust FFI Settings
ENABLE_RUST_FFI=true
RUST_FFI_PATH=../rust-core/target/release
FFI_GRACEFUL_FALLBACK=true

# Authentication Settings
# JWT_SECRET=your-generated-secret
# API_KEY=your-generated-api-key

# Logging Settings
LOG_LEVEL=info
LOG_FORMAT=text
```

## Progress Indicators

The CLI includes comprehensive progress indicators for long-running operations:

### Indexing Progress
```
üîç Indexing codebase: /path/to/project
‚†ô Scanning files...
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 100.0% (47/47 files) 25 files/s (2.1s)
‚úÖ Indexing completed!
   Files indexed: 47
   Duration: 2.13s
   Rate: 22 files/sec
```

### Search Progress
```
üîç Searching for: authentication functions
‚†ô Searching database...
‚úÖ Search completed!
   Results found: 12
   Duration: 45ms
```

## Enhanced Error Handling

The CLI provides actionable error messages with contextual suggestions:

### File System Errors
```
‚ùå Indexing failed: ENOENT: no such file or directory

üîß Possible solutions:
üí° The specified file or directory does not exist.
   Please check the path and ensure it's correct.
   Use absolute paths or ensure you're in the right directory.

üìù Indexing tips:
   ‚Ä¢ Ensure files contain supported code (TS, JS, Python, Rust, etc.)
   ‚Ä¢ Check that files are not corrupted or binary files
   ‚Ä¢ Try excluding problematic directories: --exclude node_modules,build,dist
   ‚Ä¢ Use verbose mode for more details: --verbose
```

### Database Errors
```
‚ùå Database connection failed: ECONNREFUSED

üîß Possible solutions:
üí° Connection refused. The server is not running or not accepting connections.
   Check if the server is running: codesight server
   Verify the server URL and port are correct.
```

### Permission Errors
```
‚ùå Permission denied: EACCES

üîß Possible solutions:
üí° Permission denied. You don't have the required permissions.
   Try running with elevated permissions: sudo (Unix) or Administrator (Windows)
   Check file/directory permissions: ls -la (Unix) or Get-Acl (PowerShell)
```

## Command Line Options

### Index Command
```bash
node dist/cli/index.js index <path> [options]

Options:
  -v, --verbose       Enable verbose logging
  --no-progress       Disable progress indicator
  --exclude <dirs>    Comma-separated list of directories to exclude
```

### Search Command
```bash
node dist/cli/index.js search <query> [options]

Options:
  -l, --limit <number>    Maximum number of results (default: 10)
  -t, --type <type>       Filter by entity type (class, function, etc.)
  --codebase <path>       Specify codebase to search in
```

### Stats Command
```bash
node dist/cli/index.js stats [options]

Options:
  --detailed          Show detailed breakdown by type and language
  --format <format>   Output format: table, json, csv
```

## Advanced Usage

### Custom Configuration Files
You can specify a custom configuration file location:

```bash
node dist/cli/index.js setup --config production.env
```

### Environment Override
Override configuration values with environment variables:

```bash
NODE_ENV=production LOG_LEVEL=debug node dist/cli/index.js server
```

### Verbose Mode
Enable verbose logging for troubleshooting:

```bash
LOG_LEVEL=debug node dist/cli/index.js index /path/to/project --verbose
```

## Troubleshooting

### Common Issues

1. **Setup wizard fails to start**
   - Ensure the MCP server is built: `npm run build`
   - Check Node.js version: `node --version` (requires v20+)

2. **Database connection fails**
   - Verify database server is running
   - Check connection parameters in configuration
   - Ensure database exists and credentials are correct

3. **Rust FFI not working**
   - Build Rust components: `cd ../rust-core && cargo build --release`
   - Verify library path is correct
   - Check if graceful fallback is enabled

4. **Progress indicators not showing**
   - Ensure TTY support (use `--no-progress` to disable)
   - Check if output is being redirected

### Getting Help

If you encounter issues:

1. Check the error suggestions provided by the CLI
2. Enable verbose mode: `--verbose`
3. Review configuration file syntax
4. Check the [troubleshooting guide](./troubleshooting.md)
5. Open an issue on GitHub

## Best Practices

1. **Use the setup wizard** for initial configuration to ensure all settings are properly configured
2. **Review the generated configuration** before saving to understand what each setting does
3. **Keep secrets secure** - don't commit configuration files with secrets to version control
4. **Use environment-specific configurations** for development, staging, and production
5. **Monitor logs** for performance and error tracking
6. **Update Rust components** regularly for the latest performance improvements

## Next Steps

After completing the setup:

1. **Index your first codebase**: `node dist/cli/index.js index /path/to/project`
2. **Test search functionality**: `node dist/cli/index.js search "function name"`
3. **View statistics**: `node dist/cli/index.js stats --detailed`
4. **Connect Claude Desktop**: Add MCP server configuration
5. **Enable monitoring**: Configure Prometheus metrics and Grafana dashboards