#!/usr/bin/env sh

echo "ðŸ”’ Running security checks..."

# Check for API keys and secrets
echo "ðŸ” Scanning for sensitive data..."

# Simple grep-based detection
if git diff --cached --name-only | grep -q "\.mcp\.json"; then
  echo ""
  echo "âŒ .mcp.json should not be committed (contains API keys)"
  echo "   Please add .mcp.json to .gitignore"
  echo ""
  exit 1
fi

# Check for .env files (except .env.example)
STAGED_ENVS=$(git diff --cached --name-only | grep -E "^\.env$|\.env\.local$|\.env\..*\.local$" || true)
if [ -n "$STAGED_ENVS" ]; then
  echo ""
  echo "âŒ .env files should not be committed"
  echo "   Files: $STAGED_ENVS"
  echo "   Please add to .gitignore"
  echo ""
  exit 1
fi

# Run security scan script on staged files
echo "âœ… Security check passed"
echo ""

# Run npm security check if available
if command -v npm >/dev/null 2>&1; then
  cd typescript-mcp
  if [ -f "scripts/security-scan.js" ]; then
    npm run security:check --silent 2>/dev/null || true
  fi
  cd ..
fi

echo "âœ… All pre-commit checks passed"
exit 0
